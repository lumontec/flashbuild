##### 1 Build your minimal kernel
We clone the official kernel repo and build the smallest kernel core with default configuration for our arch

Kernel compilation reference: (https://linux-sunxi.org/Mainline_Kernel_Howto)[https://linux-sunxi.org/Mainline_Kernel_Howto]

```bash
apt install git make gcc device-tree-compiler bison flex libssl-dev libncurses-dev gcc-arm-linux-gnueabi gcc-aarch64-linux-gnu
cd ./2_kernel/build
git clone https://github.com/torvalds/linux.git .
git checkout v5.9
# Gernerate arm64 specific config
ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- make defconfig
# Compile arm64 compressed image
ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- make -j8 Image
```
Flashbuild will need the **bzImage** compressed binary generated by kernel compilation, for 64bit arch you will find it under ./kernel/arch/arm64/boot/Image.
##### 2 Generate your initramfs
We use a simple Dockerfile and an init script to mount an initramfs after the kernel is loaded. These are the steps in a nutshell:
- pull base image
- install the packages that we want
- create some user
- cleanup filesystem
- add an init script to be called by the kernel
- that`s it !


Dockerfile:
```Dockerfile
FROM ubuntu:20.04 AS base
RUN  apt update 
RUN  apt -y upgrade 
# Install systemd init system
RUN  apt install -y systemd udev
# Change password for root
RUN echo "root:root" | chpasswd

# Patch fs ----------------------------
# 
# We install a basic /init script that launches
# systemd after being invoked by the kernel

# Copy all fs workdir where we patch our fs 
FROM alpine:latest
WORKDIR /fs
COPY --from=base / .

# Add init script
ADD ./src/init init
```
Init file:
```bash
#!/bin/sh
mount -t proc none /proc
mount -t sysfs none /sys
mount -t devtmpfs none /dev
echo -e "\nBoot took $(cut -d' ' -f1 /proc/uptime) seconds\n"
exec /bin/sh
```
Generate initramfs compressed archive:
```bash
make -C ./3_initramfs all ARCH=linux/arm64 
```
##### 4 Emulate
```bash
./emulate.sh
```

